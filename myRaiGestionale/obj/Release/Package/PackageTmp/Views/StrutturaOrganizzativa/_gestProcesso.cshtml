
@model myRaiCommonModel.Gestionale.GestioneProcessoModel
<style>
    <style >
    .content .left {
        float: left;
        width: 100px;
        background-color: green;
    }

    .content .right {
        margin-left: 100px;
        background-color: red;
    }
</style>
@{
    int progressivoDocumento = 0;
}
<div class="block block-transparent no-margin-bottom">
    <div class="block-header">


        @if (Model.ProcessoCorrente == null)
        {
            <label class="rai-font-modal-heading">
                Nuovo Processo
            </label>
        }
        else
        {
            <label class="rai-font-modal-heading">
                Modifica Processo
            </label>
        }


        <div class="block-options">
            <button data-dismiss="modal" class="btn btn-action-icon"><i class="glyphicon glyphicon-remove"></i></button>
        </div>

    </div>
    <div class="block-content">





















        <div class="row">
            <div class="col-sm-12">
                @using (Html.BeginPanel(myRaiHelper.PanelType.Panel, "Ramo padre: " + Model.ProcessoPadre.nome_processo, false))
                {
                    using (Html.BeginBlock(myRaiHelper.BlockType.ContentTable, ""))
                    {











                        <form action="/StrutturaOrganizzativa/SaveProcesso" id="form-modal-processo" method="post">
                            <input type="hidden" id="id-processo" name="idprocesso" value="@(Model.ProcessoCorrente != null ? Model.ProcessoCorrente.id : 0 )" />
                            <input type="hidden" id="id-processo-padre" name="idprocessopadre" value="@Model.ProcessoPadre.id" />
                            <input type="hidden" id="tipo-modifica" name="tipomodifica" />
                            <input type="hidden" name="SistemiCollegatiOld" value="@Model.SistemiCollegatiOld" />
                            <input type="hidden" name="DirezioniOwnerCollegateOld" value="@Model.DirezioniOwnerCollegateOld" />
                            <input type="hidden" name="DirezioniCoinvolteCollegateOld" value="@Model.DirezioniCoinvolteCollegateOld" />


                            <div class="block" id="praticheBlock" style="margin-bottom:0px;">
                                <ul class="nav nav-tabs nav-tabs-alt nav-justified" data-toggle="tabs" role="tablist">
                                    <li class="active" role="presentation">
                                        <a href="#btab-processi" class="rai-badge-anchor interactive-primary-color" id="hrefIncarico" tabindex="0" role="tab" aria-selected="true" aria-controls="btab-processi">
                                            PROCESSI

                                        </a>
                                    </li>
                                    <li class="" role="presentation">
                                        <a href="#btab-sistemi" id="hrefpratiche" class="rai-badge-anchor interactive-primary-color" tabindex="-1" role="tab" aria-selected="false" aria-controls="btab-pratiche">
                                            SISTEMI

                                        </a>
                                    </li>
                                    <li class="" role="presentation">
                                        <a href="#btab-owner" id="hrefpratiche" class="rai-badge-anchor interactive-primary-color" tabindex="-1" role="tab" aria-selected="false" aria-controls="btab-pratiche">
                                            OWNER
                                        </a>
                                    </li>
                                    <li class="" role="presentation">
                                        <a href="#btab-coinvolte" id="hrefpratiche" class="rai-badge-anchor interactive-primary-color" tabindex="-1" role="tab" aria-selected="false" aria-controls="btab-pratiche">
                                            DIR COINVOLTE
                                        </a>
                                    </li>
                                    <li class="" role="presentation">
                                        <a href="#btab-doc" id="hrefpratiche" class="rai-badge-anchor interactive-primary-color" tabindex="-1" role="tab" aria-selected="false" aria-controls="btab-pratiche">
                                            DOCUMENTI
                                        </a>
                                    </li>
                                </ul>
                                <div class="block-content tab-content" style="padding:5px 5px 1px;">
                                    <div class="tab-pane active" id="btab-processi" role="tabpanel">



                                        <div class="col-sm-12" style="margin-top:16px">
                                            <label class="required  rai-font-table-heading" for="Name">Codice processo</label>
                                        </div>
                                        <div class="col-sm-12" style="margin-top:1px">
                                            <input style="width:98%" id="codice-processo" type="text" name="codiceprocesso" class="form-control" required="required"
                                                   @if (Model.ProcessoCorrente != null)
                                                   { @: value="@Model.ProcessoCorrente.codice_processo"
                                                   }
                                                   else
                                                   {
                                                       if (!String.IsNullOrWhiteSpace(Model.ProcessoPadre.codice_processo))
                                                       { @: value="@(Model.ProcessoPadre.codice_processo + ".")"
                                                   }
                                                   } />
                                        </div>

                                        <div class="col-sm-12" style="margin-top:16px">
                                            <label class="required  rai-font-table-heading" for="Name">Nome processo</label>
                                        </div>
                                        <div class="col-sm-12" style="margin-top:1px">
                                            <input style="width:98%" type="text" id="nome-processo" name="nomeprocesso" class="form-control" required="required"
                                                   @if (Model.ProcessoCorrente != null)
                                                   { @: value="@Model.ProcessoCorrente.nome_processo"
                                                   } />
                                        </div>

                                        <div class="col-sm-12" style="margin-top:16px">
                                            <label class="  rai-font-table-heading" for="Name">Descrizione processo</label>
                                        </div>
                                        <div class="col-sm-12" style="margin-top:1px">
                                            <textarea style="width:98%" rows="10" id="descrizione-processo" name="descrizioneprocesso" class="form-control" >@(Model.ProcessoCorrente != null ? Model.ProcessoCorrente.descrizione_processo : "")</textarea>

                                        </div>

                                        @*<input type="file" name="Documenti[0].Filecontent" />
        <input type="hidden" name="Documenti[0].tipo" value="@myRaiCommonModel.Gestionale.TipoDocumento.Processo" />

        <input type="file" name="Documenti[2].Filecontent" />
        <input type="hidden" name="Documenti[2].tipo" value="@myRaiCommonModel.Gestionale.TipoDocumento.FlowChart" />*@
                                    </div>





                                    <div class="tab-pane" id="btab-sistemi" role="tabpanel">
                                        <div class="col-sm-12" style="margin-top:16px">
                                            <label class=" rai-font-table-heading" for="Name">SISTEMI IT</label>
                                            <div title="Aggiungi Sistema IT" id="boxFile" class=" summary-icon item item-rounded text-primary bigborder" style="width: 25px;height: 25px;line-height: 21px;float: right;font-size: 9px;margin-right: 12px;">
                                                <span id="spanAddFile" class="cursor-pointer">
                                                    <i id="iAddFile" style="font-size: 23px;" role="link" aria-label="Aggiungi l'allegato" class="" onclick="AddSistema()">+</i>
                                                </span>

                                            </div>
                                        </div>

                                        <div class="col-sm-12" style="margin-top:1px">
                                            <input style="width:98%" class="form-control" type="text" data-search="direzione-scheda" onkeyup="RaiSearchData(this, 'direzione-scheda', 'name')" placeholder="Inserisci il sistema da cercare...">
                                        </div>

                                        <div class="col-sm-12" style="margin-top:10px;margin-bottom:10px">
                                            <div class="rai-checkbox" data-search="direzione-scheda" data-search-name="">
                                                <input id="chkSelectAllDir" type="checkbox" data-check-group-all="dir-filter" onclick="RaiToggleCheckBoxAll('dir-filter')">
                                                <label class="rai-caption" for="chkSelectAllDir">Seleziona tutti</label>
                                            </div>
                                        </div>

                                        <div id="box-sistemi" class="col-sm-12" style="max-height:400px; overflow-y:scroll">
                                            @{
                                               Html.RenderAction("getsistemi", Model);
                                            }

                                            @*@foreach (var sist in Model.Sistemi)
                                            {

                                                <div class="col-sm-6  " style="margin-top:10px" data-search="direzione-scheda" data-search-name="@sist.nome_sistema">
                                                    <div class="rai-checkbox">
                                                        <input name="sistemaIT" type="checkbox" data-check-group="dir-filter"
                                                               @if (Model.SistemiCollegati.Select(x => x.id).Contains(sist.id)) { @: checked="checked"
                                                               }
                                                               value="@sist.id">
                                                        <label class="rai-caption" for="filter36">@sist.nome_sistema</label>
                                                    </div>
                                                </div>
                                            }*@
                                        </div>

                                    </div>

                                    <div class="tab-pane" id="btab-owner" role="tabpanel">
                                        <div class="col-sm-12" style="margin-top:16px">
                                            <label class=" rai-font-table-heading" for="Name">PROCESS OWNER</label>
                                        </div>
                                        <div class="col-sm-12" style="margin-top:1px">
                                            <input style="width:98%" class="form-control" type="text" data-search="direzione-owner" onkeyup="RaiSearchData(this, 'direzione-owner', 'name')" placeholder="Inserisci la direzione da cercare...">
                                        </div>
                                        <div class="col-sm-12" style="margin-top:10px;margin-bottom:10px">
                                            <div class="rai-checkbox" data-search="direzione-owner" data-search-name="">
                                                <input id="chkSelectAllDir" type="checkbox" data-check-group-all="dir-owner" onclick="RaiToggleCheckBoxAll('dir-owner')">
                                                <label class="rai-caption" for="chkSelectAllDir">Seleziona tutti</label>
                                            </div>
                                        </div>

                                        <div class="col-sm-12" style="max-height:400px; overflow-y:scroll">
                                            @foreach (var dir in Model.DirezioniOwner)
                                            {

                                                <div class="col-sm-12  " style="margin-top:10px" data-search="direzione-owner" data-search-name="@dir.descrizione_lunga">
                                                    <div class="rai-checkbox">
                                                        <input name="dirOwner" type="checkbox" data-check-group="dir-owner"
                                                               @if (Model.DirezioniOwnerCollegate.Select(x => x.id).Contains(dir.id)) { @: checked="checked"
                                                               }
                                                               value="@dir.id">
                                                        <label class="rai-caption" for="filter36">@dir.descrizione_lunga</label>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>


                                    <div class="tab-pane" id="btab-coinvolte" role="tabpanel">

                                        <div class="col-sm-12" style="margin-top:16px">
                                            <label class=" rai-font-table-heading" for="Name">DIREZIONI COINVOLTE</label>
                                        </div>
                                        <div class="col-sm-12" style="margin-top:1px">
                                            <input style="width:98%" class="form-control" type="text" data-search="direzione-coinv" onkeyup="RaiSearchData(this, 'direzione-coinv', 'name')" placeholder="Inserisci la direzione da cercare...">
                                        </div>
                                        <div class="col-sm-12" style="margin-top:10px;margin-bottom:10px">
                                            <div class="rai-checkbox" data-search="direzione-coinv" data-search-name="">
                                                <input id="chkSelectAllDir" type="checkbox" data-check-group-all="dir-coinv" onclick="RaiToggleCheckBoxAll('dir-coinv')">
                                                <label class="rai-caption" for="chkSelectAllDir">Seleziona tutti</label>
                                            </div>
                                        </div>
                                        <div class="col-sm-12" style="max-height:400px; overflow-y:scroll">
                                            @foreach (var dir in Model.DirezioniCoinvolte)
                                            {

                                                <div class="col-sm-12  " style="margin-top:10px" data-search="direzione-coinv" data-search-name="@dir.descrizione_lunga">
                                                    <div class="rai-checkbox">
                                                        <input name="dirCoinvolte" type="checkbox" data-check-group="dir-coinv"
                                                               @if (Model.DirezioniCoinvolteCollegate.Select(x => x.id).Contains(dir.id)) { @: checked="checked"
                                                               }
                                                               value="@dir.id">
                                                        <label class="rai-caption" for="filter36">@dir.descrizione_lunga</label>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="btab-doc" role="tabpanel">



                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">DOCUMENTI DI PROCESSO</label>
                                                <div style="width: 100%;background-color: #eee;height: 2px;margin-bottom: 12px;"></div>
                                            </div>
                                        </div>

                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Processo.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Processo.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Processo.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }

                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Processo.ToString() })





                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">MASTER</label>
                                                <div style="width: 100%;background-color: #eee;height: 2px;margin-bottom: 12px;"></div>
                                            </div>
                                        </div>
                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Master.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Master.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Master.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }
                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Master.ToString() })






                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">FLOWCHART</label>
                                                <div style="width: 100%;background-color: #eee;height: 2px;margin-bottom: 12px;"></div>
                                            </div>
                                        </div>
                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.FlowChart.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.FlowChart.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.FlowChart.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }
                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.FlowChart.ToString() })






                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">PROCESS MAP</label>
                                                <div style="width: 100%;background-color: #eee;height: 2px;margin-bottom: 12px;"></div>
                                            </div>
                                        </div>
                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.ProcessMap.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.ProcessMap.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.ProcessMap.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }

                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.ProcessMap.ToString() })







                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">PROCESS IDENTITY CARD</label>
                                                <div style="width: 100%;background-color: #eee;height: 2px;margin-bottom: 12px;"></div>
                                            </div>
                                        </div>
                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.ProcessIdentity.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.ProcessIdentity.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.ProcessIdentity.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }
                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.ProcessIdentity.ToString() })





                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">ALLEGATI FACOLTATIVI</label>
                                                <div style="width: 100%;background-color: #eee;height: 2px;margin-bottom: 12px;"></div>
                                            </div>
                                        </div>
                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Allegati.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Allegati.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Allegati.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }
                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Allegati.ToString() })




                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">PROCEDURA</label>
                                            </div>
                                        </div>
                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Procedura.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.Procedura.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Procedura.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }
                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.Procedura.ToString() })





                                        <div class="row">
                                            <div class="col-sm-12" style="margin-top:16px;">
                                                <label class=" rai-font-table-heading" for="Name">ISTRUZIONI OPERATIVE</label>
                                                <div style="width: 100%;background-color: #eee;height: 2px;margin-bottom: 12px;"></div>
                                            </div>
                                        </div>
                                        @if (Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.IstruzioniOperative.ToString()).Any())
                                        {
                                            foreach (var al in Model.Allegati.Where(x => x.categoria == myRaiCommonModel.Gestionale.TipoDocumento.IstruzioniOperative.ToString()))
                                            {
                                                @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.IstruzioniOperative.ToString(), Allegato = al, progressivo = progressivoDocumento })

                                                progressivoDocumento++;
                                            }
                                        }
                                        @Html.Partial("_boxAllegato", new myRaiCommonModel.Gestionale.BoxAllegatoModel() { tipo = myRaiCommonModel.Gestionale.TipoDocumento.IstruzioniOperative.ToString() })

                                    </div>


                                </div>

                            </div>


                            <div class="form-group">
                                <div class="row">








































                                    @if (Model.ProcessoCorrente == null)
                                    {
                                        <div class="col-sm-12">
                                            <div style="margin-top:24px" class="rai-btn-fill">
                                                <button class="btn btn-primary" onclick="">Salva nuovo processo</button>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-sm-12">
                                            <div style="margin-top:24px" class="rai-btn-fill">
                                                <button class="btn rai-btn-secondary" onclick="$('#tipo-modifica').val('R')">Rettifica</button>
                                                <button class="btn rai-btn-primary" onclick="$('#tipo-modifica').val('M')">Modifica</button>
                                            </div>
                                        </div>
                                    }




                                </div>
                            </div>


                        </form>
                    }
                }
            </div>
        </div>
    </div>
</div>
<script>

    var NextProgressivoDaUsare= @progressivoDocumento ;

    function cancellaSistema(id) {
        $.ajax({
            url: '/StrutturaOrganizzativa/cancellaSistema',
            type: "GET",
            data: {id:id},

            dataType: "json",
            complete: function () { },
            success: function (data) {
               
                if (data.esito == false)
                    swal(data.error);
                else {
                    getSistemiEditor();
                    AggiornaBoxSistemi();
                    swal("Modifiche eseguite con successo", "", "success");
                }

            }
        });
    }
    function getSistemiEditor() {
        $("#sist-container").addClass("rai-loader");
        $.ajax({
            url: '/StrutturaOrganizzativa/_sistemi',
            type: "GET",
            data: {},

            dataType: "html",
            complete: function () { },
            success: function (data) {
                $("#sist-container").removeClass("rai-loader");
                $("#sist-container").html(data);
                $("#sist").modal("show");

            }
        });
      
    }
    function AggiornaBoxSistemi() {
        $.ajax({
            url: '/StrutturaOrganizzativa/getsistemi',
            type: "GET",
            data: { idprocesso: $("#id-processo").val(), data: $("#data-strut").val() },

            dataType: "html",
            complete: function () { },
            success: function (data) {

                $("#box-sistemi").html(data);


            }
        });
    }
    function AggiungiSistemaDB() {
        var nome = $("#nome-sistema").val();
        if (nome == null || nome.trim() == "") {
            swal("Immettere un nome valido");
            return;
        }
        var idsistema = 0;
        $.ajax({
            url: '/StrutturaOrganizzativa/addSistema',
            type: "POST",
            data: { sistema: nome },

            dataType: "json",
            complete: function () { },
            success: function (data) {
                if (data.esito == false) {
                    swal(data.error);
                }
                else {
                    getSistemiEditor();
                    AggiornaBoxSistemi();
                    swal("Modifiche eseguite con successo", "", "success");
                }
            }
        });
    }
    function AddSistema() {

        $.ajax({
            url: '/StrutturaOrganizzativa/_sistemi',
            type: "GET",
            data: {  },

            dataType: "html",
            complete: function () { },
            success: function (data) {
              
                $("#sist-container").html(data);
                $("#sist").modal("show");
               
            }
        });
        return;


        swal({
            title: '<strong>Aggiungi sistema</strong>',
            icon: 'info',
            html:
                'Inserisci il nome del nuovo sistema IT da aggiungere al catalogo' +
                '<input id="nome-sistema" type="text" class="form-control" maxlength="300" /> ' +
                '',
            reverseButtons: true,
            showCloseButton: true,
            showCancelButton: true,
            focusConfirm: false,
            confirmButtonText:
                'OK',

            cancelButtonText:
                'Annulla'
        }).then(function () {

            var nome = $("#nome-sistema").val();
            if (nome == null || nome.trim() == "") {
                swal("Immettere un nome valido");
                return;
            }
            var idsistema = 0;
            $.ajax({
                url: '/StrutturaOrganizzativa/addSistema',
                type: "POST",
                data: {sistema:nome},
               
                dataType: "json",
                complete: function () { },
                success: function (data) {
                    if (data.esito == false) {
                        swal(data.error);
                    }
                    else {
                        idsistema = data.error;
                        swal("Modifiche eseguite con successo", "", "success");
                        var item = ' <div class="col-sm-6  " style="margin-top:10px" data-search="direzione-scheda" data-search-name="' + nome + '">' +
                            ' <div class="rai-checkbox">' +
                            ' <input name="sistemaIT" type="checkbox" data-check-group="dir-filter"' +

                            'value="' + idsistema + '">' +
                            ' <label class="rai-caption" for="filter36">' + nome + '</label>' +
                            ' </div>' +
                            ' </div>';
                        $("#box-sistemi").append(item);
                    }
                }
            });

           
           
            });
    }
    function AddAllegatoProcesso(inp) {
        var div = $(inp).closest(".box-allegato");
        var inpfile = $(div).find("input[type='file']")[0];
        inpfile.click();
    }

    function GetProgressivoDaUsare() {

        return NextProgressivoDaUsare;
    }
    function ModificaAllegato(inp) {
        var div = $(inp).closest(".box-allegato");
        var TBaction = $(div).find("input.doc-action")[0];
        $(TBaction).val("M");
    }
    function CancellaAllegato(inp) {
        debugger
        swal({
            title: "L'associazione al documento verrà eliminata, confermi ?",
            html: "",
            type: 'question',
            showCloseButton: true,
            showCancelButton: true,
            reverseButtons: true,
            cancelButtonText: "Annulla",    
            confirmButtonText: ' OK'
        })
            .then(function () {
                var div = $(inp).closest(".box-allegato");
                var TBaction = $(div).find("input.doc-action")[0];
                $(TBaction).val("D");
                $(inp).addClass("disable");

                var TBnome = $(div).find("input[type=text]")[0];
                var TBdesc = $(div).find("textarea")[0];
                $(TBnome).attr("readonly", "readonly");
                $(TBdesc).attr("readonly", "readonly");
                $(TBnome).css("background-color", "#eee");
                $(TBdesc).css("background-color", "#eee");
            });

        
    }

    function CheckAllegato(inp) {
        var f = $(inp)[0].files.length;
        if (f > 0) {
            var div = $(inp).closest(".box-allegato");
            var TBnome = $(div).find("input[type=text]")[0];
            var TBdesc = $(div).find("textarea")[0];
            var TBaction = $(div).find("input.doc-action")[0];
            var TBtipo = $(div).find("input.doc-tipo")[0];

            if ($(TBnome).attr("data-progr-allegato") == undefined) {
                var p = GetProgressivoDaUsare();
                $(TBnome).attr("data-progr-allegato", p);
                $(TBnome).attr("name", "Documenti[" + p + "].Nome");

                $(TBdesc).attr("data-progr-allegato", p);
                $(TBdesc).attr("name", "Documenti[" + p + "].Desc");

                $(TBaction).attr("name", "Documenti[" + p + "].Action");
                $(TBtipo).attr("name", "Documenti[" + p + "].Tipo");

                $(inp).attr("name","Documenti["+p+"].Filecontent")
                                                }

            $(TBaction).val("N");
                                                var t = $(div).attr("data-tipo");
            $(TBtipo).val(t);
            $(TBnome).show().val($(inp)[0].files[0].name);
            $(TBdesc).show().val("");


                                                if ($(div).next("div.box-allegato[data-tipo='" + t + "']").length == 0) {

                                                    NextProgressivoDaUsare++;
                $.ajax({
                                                    url: '/StrutturaOrganizzativa/getboxallegato',
                    type: "GET",
                    dataType: "html",

                    data: { tipo: $(div).attr("data-tipo") },
                    success: function (data) {
                        $(data).insertAfter($(div));
                                                        }
                                                    });
                                                }


                                            }
                                        }





                                        @if (Model.ProcessoCorrente == null)
                                        {
         @:moveCursorToEnd("codice-processo");
     }
             function moveCursorToEnd(id) {
                 var el = document.getElementById(id)
         el.focus()
         if (typeof el.selectionStart == "number") {
                     el.selectionStart = el.selectionEnd = el.value.length;
                 } else if (typeof el.createTextRange != "undefined") {
                     var range = el.createTextRange();
                     range.collapse(false);
                     range.select();
                 }
             }

    $("#form-modal-processo").submit(function (event) {

             var form = this;

        event.stopPropagation();
        event.preventDefault();

        var tipo = $("#tipo-modifica").val();

         var msg = "";
        if (tipo == "R")
            msg = "Confermi di modificare i dati nello stesso periodo di validità ?";
        else if (tipo == "M")
            msg = "Confermi di salvare i dati del processo con un nuovo periodo di validità a partire da oggi ?";
        else
            msg = "Confermi di aggiungere questo nuovo processo ?";

        var formData = new FormData(form);

        swal({
         title: msg,
            html: "",
            type: 'question',
            showCloseButton: true,
            showCancelButton: true,
            reverseButtons: true,
            cancelButtonText: "Annulla",    
            confirmButtonText: ' OK'
        })
            .then(function () {
                $.ajax({
             url: '/StrutturaOrganizzativa/saveProcesso',
                    type: "POST",
                    data: formData,//serializedForm,
                    processData: false,
                    contentType: false,
                    dataType: "json",
                    complete: function () { },
                    success: function (data) {
                     if (data.esito == false) {
                         swal(data.error);
                     }
                     else {
                         swal("Modifiche eseguite con successo", "", "success");
                            $("#modal-processi").modal("hide");
                         OnDataStrutChangeProcessi();
                     }
                 }
             });
         });


        var serializedForm = $(form).serialize();


     });
</script>