@using System.Globalization;
@using myRaiHelper;
@using myRaiHelper;
@using myRaiCommonModel;
@using MVCProject.Custom_Helpers;
@using myRaiCommonManager;

@model ModelDash
<div id="modal">
    <div class="modal right fade" id="modal-popin-modifica" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-dialog-popin">
            <div class="modal-content height100">
                @using (Html.BeginModal("Modifica evento"))
                {
                    using (Html.BeginForm("", "", FormMethod.Post, new { id = "form-evento-mod" }))
                    {
                        <div class="form-group">
                            @if (Model.ListaEventi != null && Model.ListaEventi.Count > 0)
                            {
                                foreach (var item in Model.ListaEventi)
                                {
                                    <div class="row ">
                                        <div class="col-sm-6">
                                            @using (Html.BeginPanel(PanelType.Panel, "Dati generali", false))
                                            {
                                                <div class="row push-10">
                                                    <div class="col-sm-12">
                                                        <label class="rai-caption">Titolo</label>
                                                        <input class="form-control" type="text" id="titoloupd" name="titolo" placeholder="Inserisci titolo" value="@item.titolo">
                                                    </div>
                                                </div>
                                                <div class="row push-10">
                                                    <div class="col-sm-12">
                                                        <label class="rai-caption">Sede contabile</label>
                                                        <input class="form-control" type="text" id="sedecontabile" name="sedecontabile" placeholder="Inserisci sede contabile" value="@item.sede_contabile">
                                                    </div>
                                                </div>


                                                <div class="row">
                                                    <div class="col-sm-12">
                                                        <label class="rai-caption">Data/ora inizio evento</label>
                                                    </div>
                                                </div>
                                                <div class="row push-10">
                                                    <div class="col-xs-6">
                                                        <div class="input-group">
                                                            <span style="cursor: pointer" onclick="$('#datainizio').datetimepicker('show')" class="input-group-addon"><i class="icons icon-calendar"></i></span>
                                                            <input class="js-datetimepicker form-control" type="text" data-format="DD/MM/YYYY" data-locale="it" id="datainizio" name="datainizio" placeholder="inserisci data" value="@item.data_inizio.Value.ToShortDateString()">
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <input type="time" id="orarioInizio" class="form-control" name="orarioInizio" style="font-size:1.2em" value="@item.data_inizio.Value.ToString("HH:mm")" />
                                                    </div>
                                                </div>

                                                <div class="row push-10">
                                                    <div class="col-sm-12">
                                                        <label class="rai-caption">Luogo Evento</label>
                                                        <input class="form-control" type="text" id="luogoupd" name="luogo" placeholder="inserisci luogo" value="@item.luogo">
                                                    </div>
                                                </div>

                                                using (Html.BeginBlock(BlockType.ContentTable, "Dati prenotazioni"))
                                                {
                                                    <div class="row push-10">
                                                        <div class="col-xs-6">
                                                            <label class="rai-caption">Totale</label>
                                                            <input class="form-control" id="numeroTotaleupd" name="numeroTotale" placeholder="Totale" type="number" value="@item.numero_totale">
                                                        </div>
                                                        <div class="col-xs-6">
                                                            <label class="rai-caption">Massimo per persona</label>
                                                            <input class="form-control" id="numeroMassimoupd" name="numeroMassimo" placeholder="Massimo" type="number" value="@item.numero_massimo">
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <label class="rai-caption">Data/ora apertura</label>
                                                        </div>
                                                    </div>
                                                    <div class="row push-10">
                                                        <div class="col-xs-6">
                                                            <div class="input-group">
                                                                <span class="input-group-addon"><i class="icons icon-calendar"></i></span>
                                                                <input class="js-datetimepicker form-control annoinizio" type="text" data-format="DD/MM/YYYY" data-locale="it" id="dataApertura" name="dataApertura" placeholder="inserisci data" value="@item.data_inizio_prenotazione.Value.ToShortDateString()">
                                                            </div>
                                                        </div>
                                                        <div class="col-xs-6">
                                                            <input type="time" step="300" class="form-control" id="orarioApertura" name="orarioApertura" style="font-size:1.2em;" value="@item.data_inizio_prenotazione.Value.ToString("HH:mm")" />
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-12">
                                                            <label class="rai-caption">Data/ora chiusura</label>
                                                        </div>
                                                    </div>
                                                    <div class="row push-10">
                                                        <div class="col-xs-6">
                                                            <div class="input-group">
                                                                <span class="input-group-addon"><i class="icons icon-calendar"></i></span>
                                                                <input class="js-datetimepicker form-control annoinizio" type="text" data-format="DD/MM/YYYY" data-locale="it" id="dataChiusura" name="dataChiusura" placeholder="inserisci data" value="@item.data_fine_prenotazione.Value.ToShortDateString()">
                                                            </div>
                                                        </div>
                                                        <div class="col-xs-6">
                                                            <input type="time" step="300" id="orarioChiusura" name="orarioChiusura" class="form-control" style="font-size:1.2em" value="@item.data_fine_prenotazione.Value.ToString("HH:mm")" />
                                                        </div>
                                                    </div>

                                                    <div class="row push-10">
                                                        <div class="col-sm-12">
                                                            <label class="rai-caption">Programma</label>
                                                            <select name="programmaupd" id="programmaupd" class="form-control" onchange="selectProgramUpd()">
                                                                @if (Model.Programs.listaProgrammi != null)
                                                                {
                                                                    <option value="0">Nessun Programma</option>
                                                                    foreach (var item1 in Model.Programs.listaProgrammi)
                                                                    {
                                                                        if (item.id_programma == Convert.ToInt32(item1.Value))
                                                                        {
                                                                            <option value="@item1.Value" selected>@item1.Text</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value="@item1.Value">@item1.Text</option>
                                                                        }
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row push-10">
                                                        <div class="col-sm-12">
                                                            <label class="rai-caption">Note Email</label>
                                                            <textarea class="form-control" id="noteEmail" name="noteEmail" rows="5" placeholder="Descrivere le note dell'email">@item.testo_mail</textarea>
                                                        </div>
                                                    </div>

                                                    <div class="row push-10">
                                                        <div class="col-sm-12">
                                                            <div class="rai-checkbox">
                                                                @if (item.vedi_insediamento == true)
                                                                {
                                                                    <input type="checkbox"
                                                                           name="checkInsediamento" checked="checked" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="checkbox" name="checkInsediamento" />
                                                                }
                                                                <label for="checkInsediamento">Specifica Insediamento</label>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row push-10">
                                                        <div class="col-sm-12">
                                                            <label class="rai-caption">Limite età</label>
                                                            <input class="form-control" id="limiteEta" name="limiteEta" placeholder="Limite età" type="number" value="@item.limite_eta">
                                                        </div>
                                                    </div>

                                                    <div class="row push-10">
                                                        <div class="col-sm-12">
                                                            <div class="rai-checkbox">
                                                                @if (item.ticket == true)
                                                                {
                                                                    <input type="checkbox"
                                                                           name="ticket" checked="checked" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="checkbox" name="ticket" />
                                                                }
                                                                <label>Codice prenotazione</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                }

                                                <div class="row">
                                                    <div class="col-sm-12 ">

                                                        <input type="hidden" id="idEvento" name="idEvento" value="@item.id" />
                                                        <div class="rai-btn-fill">
                                                            <button id="b1" type="submit" class="btn rai-btn-primary">Modifica Evento</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                        <div class="col-sm-6">
                                            @using (Html.BeginPanel(PanelType.Panel, "Sede e matricole abilitate", false))
                                            {
                                                <div class="row push-10">
                                                    <div class="col-sm-12">
                                                        <label class="rai-caption">Sedi</label>
                                                        @{string sedi = ""; }
                                                        @foreach (var item2 in item.B2RaiPlace_Eventi_Sede)
                                                        {
                                                            sedi += item2.sede_gapp + ";";
                                                        }
                                                        @if (sedi.Length > 0)
                                                        {
                                                            sedi = sedi.Substring(0, sedi.Length - 1);
                                                        }

                                                        <input class="form-control" type="text" id="sediupd" name="sediupd" placeholder="inserisci sedi" value="@sedi">
                                                    </div>
                                                </div>
                                                <div class="row push-10">
                                                    <div class="col-sm-12">
                                                        <label class="rai-caption">Matricole</label>
                                                        @{string matricole = ""; }
                                                        @foreach (var item2 in item.B2RaiPlace_Eventi_Utenti_Abilitati)
                                                        {
                                                            matricole += item2.Matricola + ";";
                                                        }
                                                        @if (matricole.Length > 0)
                                                        {
                                                            matricole = matricole.Substring(0, matricole.Length - 1);
                                                        }

                                                        <input class="form-control" type="text" id="matricoleupd" name="matricoleupd" placeholder="inserisci matricole" value="@matricole">
                                                    </div>
                                                </div>
                                            }

                                            @using (Html.BeginPanel(PanelType.Panel, "Gestione campi", false))
                                            {

                                                <table class="table table-striped rai-table rai-table-vcenter">
                                                    <thead>
                                                        <tr>
                                                            <th style="width:auto;">Nome campo</th>
                                                            <th class="text-center" style="width:50px;">Visibili</th>
                                                            <th class="text-center" style="width:75px;">Obbligatori</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                <label class="">Email</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox">
                                                                    @{
                                                                        var email = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "email").ToList();
                                                                    }

                                                                    @if (email.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_email" id="check_vis_email" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (email.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_email" id="check_vis_email" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_email" id="check_vis_email" />
                                                                        }
                                                                    }
                                                                    <label></label>

                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (email.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_email" id="check_obl_email" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (email.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_email" id="check_obl_email" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_email" id="check_obl_email" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <label>Data nascita</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox">
                                                                    @{
                                                                        var datanascita = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "datanascita").ToList();
                                                                    }

                                                                    @if (datanascita.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_datnas" id="check_vis_datnas" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (datanascita.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_datnas" id="check_vis_datnas" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_datnas" id="check_vis_datnas" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (datanascita.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_datnas" id="check_obl_datnas" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (datanascita.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_datnas" id="check_obl_datnas" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_datnas" id="check_obl_datnas" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <label class="">Città nascita</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox">
                                                                    @{
                                                                        var citnas = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "citta").ToList();
                                                                    }

                                                                    @if (citnas.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_citnas" id="check_vis_citnas" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (citnas.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_citnas" id="check_vis_citnas" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_citnas" id="check_vis_citnas" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (citnas.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_citnas" id="check_obl_citnas" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (citnas.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_citnas" id="check_obl_citnas" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_citnas" id="check_obl_citnas" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <label class="">Genere</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox text-center">
                                                                    @{
                                                                        var genere = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "genere").ToList();
                                                                    }

                                                                    @if (genere.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_gen" id="check_vis_gen" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (genere.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_gen" id="check_vis_gen" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_gen" id="check_vis_gen" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (genere.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_gen" id="check_obl_gen" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (genere.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_gen" id="check_obl_gen" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_gen" id="check_obl_gen" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <label class="">Telefono</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox text-center">
                                                                    @{
                                                                        var telefono = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "telefono").ToList();
                                                                    }

                                                                    @if (telefono.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_tel" id="check_vis_tel" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (telefono.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_tel" id="check_vis_tel" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_tel" id="check_vis_tel" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (telefono.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_tel" id="check_obl_tel" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (telefono.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_tel" id="check_obl_tel" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_tel" id="check_obl_tel" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <label class="">Documento</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox text-center">
                                                                    @{
                                                                        var doc = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "doc").ToList();
                                                                    }

                                                                    @if (doc.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_doc" id="check_vis_doc" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (doc.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_doc" id="check_vis_doc" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_doc" id="check_vis_doc" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (doc.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_doc" id="check_obl_doc" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (doc.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_doc" id="check_obl_doc" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_doc" id="check_obl_doc" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <label class="">Grado di parentela</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox">
                                                                    @{
                                                                        var grado = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "grado").ToList();
                                                                    }

                                                                    @if (grado.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_gra" id="check_vis_gra" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (grado.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_gra" id="check_vis_gra" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_gra" id="check_vis_gra" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (grado.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_gra" id="check_obl_gra" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (grado.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_gra" id="check_obl_gra" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_gra" id="check_obl_gra" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <label class="">Nota</label>
                                                            </td>
                                                            <td class="text-center" style="padding-left:20px;">
                                                                <div class="rai-checkbox">
                                                                    @{
                                                                        var nota = item.B2RaiPlace_Eventi_Campi.Where(a => a.Descrizione == "nota").ToList();
                                                                    }

                                                                    @if (nota.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_vis_nota" id="check_vis_nota" checked="checked" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (email.FirstOrDefault().Visibile)
                                                                        {
                                                                            <input type="checkbox" name="check_vis_nota" id="check_vis_nota" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_vis_nota" id="check_vis_nota" />
                                                                        }
                                                                    }
                                                                    <label></label>

                                                                </div>
                                                            </td>
                                                            <td class="text-center" style="padding-left:35px;">
                                                                <div class="rai-checkbox">
                                                                    @if (nota.Count == 0)
                                                                    {
                                                                        <input type="checkbox" name="check_obl_nota" id="check_obl_nota" />
                                                                    }
                                                                    else
                                                                    {
                                                                        if (nota.FirstOrDefault().Obbligatorio)
                                                                        {
                                                                            <input type="checkbox" name="check_obl_nota" id="check_obl_nota" checked="checked" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" name="check_obl_nota" id="check_obl_nota" />
                                                                        }
                                                                    }
                                                                    <label></label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>


                                            }
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                    }
                }
            </div>
        </div>
    </div>
</div>
