@using System.Globalization;
@using myRaiHelper;
@using myRaiCommonModel;
@using MVCProject.Custom_Helpers;

<!DOCTYPE html>
<!--[if IE 9]>         <html class="ie9 no-focus" lang="en"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-focus" lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">

    <title>myRai</title>

    <meta name="description" content="myRai">
    <meta name="author" content="">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


    <!-- Icone -->

    <link rel="shortcut icon" href="~/assets/img/favicons/favicon.png">

    <link rel="icon" type="image/png" href="~/assets/img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="~/assets/img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="~/assets/img/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="~/assets/img/favicons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="~/assets/img/favicons/favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="57x57" href="~/assets/img/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="~/assets/img/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="~/assets/img/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="~/assets/img/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="~/assets/img/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="~/assets/img/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="~/assets/img/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="~/assets/img/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="~/assets/img/favicons/apple-touch-icon-180x180.png">
    <!-- Fine Icone -->
    <!-- Fogli di stile -->
    <!-- Web fonts -->
    <link rel="stylesheet" href="~/assets/css/fontG.css">
    <!-- JS Plugins CSS vanno qui -->

    <link rel="stylesheet" href="~/assets/js/plugins/sweetalert2/sweetalert2.css">
    <!-- Bootstrap and myRai CSS framework -->
    <link rel="stylesheet" href="~/assets/css/bootstrap.min.css">
    <link rel="stylesheet" id="css-main" href="~/assets/css/UIRai.css">

    <!-- Si può aggiungere un foglio di stile custom, tipo: -->
    <!-- <link rel="stylesheet" id="css-theme" href="~/assets/css/themes/digigapp.min.css"> -->
    <!-- Fine Fogli di stile -->
</head>
<body>
    <div id="page-loaderR"><span class="loaderR"><span class="loader-innerR">S</span></span></div>

    <!-- Container di Pagina -->

    <div id="page-container" class="sidebar-l sidebar-mini sidebar-o header-navbar-fixed">
        @Html.Partial( "../Shared/sidebar3" , myRaiHelper.UtenteHelper.getSidebarModel(  ) )
        @Html.Partial( "../Shared/header" )
        <!-- Main Container -->
        <main id="main-container">
            <div class="content">
                <div class="row">
                    <div class="col-sm-5 col-lg-3">
                        @Html.Partial( "../Responsabile/menusedigapp" )
                    </div>
                    <div id="EccezioniContainer" class="col-sm-7 col-lg-9">
                        <div id="daapprovare">
                            <h2 class="content-heading">Le cose da approvare </h2>
                            @Html.Partial( "../Richieste/_motivoRifiuto" )

                            <div id="idEccezioniList" />
                            @*<div class="block" id="my-block">
                                <ul class="nav nav-tabs nav-tabs-alt" data-toggle="tabs" id="mainul">
                                    <li class="active">
                                        <a href="#btabdapprovare">Da Approvare</a>
                                    </li>
                                    <li>
                                        <a href="#btabdapprovati">Approvati</a>
                                    </li>
                                    <li class="">
                                        <a href="#btabrifiutati">Rifiutati</a>
                                    </li>
                                    <li class="pull-right">
                                        <ul class="block-options push-10-t push-10-r">
                                            <li>
                                                <button type="button" data-toggle="block-option" data-action="refresh_toggle"
                                                    data-refreshurl="/home/refreshDaApprovare" data-parentdiv="daapprovare"
                                                    data-refreshelements="my-block"
                                                    data-action-mode="demo">
                                                    <i class="si si-refresh"></i>
                                                </button>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>

                                <div class="block-content tab-content">

                                </div>
                            </div>*@
                        </div>
                        <div id="infinitescroll" />
                    </div>
                </div>
            </div>
        </main>
        <!-- FINE Main Container -->

    </div>
    <!-- FINE Page Container -->


    <div class="modal fade" id="giornata-modal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
    </div>

    <!-- Partial view per modali -->

    @Html.Partial( "../Richieste/richiestapermesso" )
    @Html.Partial( "../Richieste/richiestamaggiorazione" )

    <!-- FINE Partial view per modali -->
    <!-- UIRai Core JS: jQuery, Bootstrap, slimScroll, scrollLock, Appear, CountTo, Placeholder, Cookie e App.js -->

    <script src="~/assets/js/core/jquery.min.js"></script>
    <script src="~/assets/js/core/bootstrap.min.js"></script>
    <script src="~/assets/js/core/jquery.slimscroll.min.js"></script>
    <script src="~/assets/js/core/jquery.scrollLock.min.js"></script>
    <script src="~/assets/js/core/jquery.appear.min.js"></script>
    <script src="~/assets/js/core/jquery.countTo.min.js"></script>
    <script src="~/assets/js/core/jquery.countTo.min.js"></script>
    <script src="~/assets/js/core/jquery.placeholder.min.js"></script>
    <script src="~/assets/js/core/js.cookie.min.js"></script>
    <script src="~/assets/js/core/moment.js"></script>
    <script src="~/assets/js/core/JSRai.js"></script>






    <!-- Plugins JS di pagina  + Codice JS di pagina -->
    <script src="~/assets/js/plugins/sweetalert2/es6-promise.auto.min.js"></script>
    <script src="~/assets/js/plugins/sweetalert2/sweetalert2.min.js"></script>
    <script src="~/assets/js/myrai.js"></script>

    <script src="~/assets/js/plugins/bootstrap-year-calendar/bootstrap-year-calendar.js"></script>
    <script src="~/\assets\js\core\jquery.slimscroll.min.js"></script>
    <script language="javascript">
        UIRai.initHelpers('strumenti-table');

        //numero eccezioni per chiamata ------------------------------------------------

        //serve per il refreshButton, siccome torna da ajax l'evento deve essere attaccato al document
        //$(document).on("click", "#refreshEccList", function (e) {
        //    var sede = $('#sediul li.active a').attr('data-sede').trim();
        //    LoadEccezioni(sede, 0, 10);
        //});


        $(document).ready(function () {
            Handlers();

            //serve per il refreshButton, siccome torna da ajax l'evento deve essere già attaccato
            $('body').on('click', "#refreshEccList", function (e) {
                var sede = $('#sediul li.active a').attr('data-sede').trim();
                LoadEccezioni(sede, 0);
            });

            $("a[data-sede]").click(function (evt) {
                var sede = $.trim($(this).attr("data-sede"));
                var descrsede = $(this).attr("data-sededescr");
                UIRai.loader('show');
                LoadEccezioni(sede, 0);
                UIRai.loader('hide');
                evt.preventDefault();
                evt.stopPropagation();
                return false;
            });

            $("a[data-sede]").first().click();

            $('#main-container').scroll(function () {
                var isout = IsElementOutViewport($('#infinitescroll'));
                if (isout) {
                    InfiniteScrollEccezioni();
                }
            });


            //UIRai.initHelpers('notify');
            //UIRai.initHelpers('strumenti-table');
            //UIRai.initHelpers('datetimepicker');
        });

        var richiamascroll = true;

        function InfiniteScrollEccezioni() {
            var ActiveList = $('#TotaleEccezioniTable .tab-pane.active').attr('id');
            var sede = $('#sediul li.active a').attr('data-sede').trim();
            var nrig = $('#' + ActiveList + ' tr[class*=hid]').size();
            var Totalerig = $('#' + ActiveList).attr('data-Tot');

            if (nrig >= Totalerig || !richiamascroll)
                return;

            var da = nrig;
            richiamascroll = false;
            LoadEccezioni(sede, da, ActiveList);
        }

        function LoadEccezioni(sede, da, listaAttiva) {
            $("#idEccezioniList>.block").addClass("block-opt-refresh"); //serve per il loader
            //$("#my-block>.block").addClass("block-opt-refresh");

            $("a[data-sede]").parent().removeClass('active');
            $('a[data-sede*="' + sede + '"]').parent().addClass('active'); //rende attiva la sede
            $.ajax({
                type: 'GET',
                url: "@Url.Action("GetEccezioniHTML", "Responsabile")",
                dataType: "html",
                data: { sede: sede, da: da, ActiveList: listaAttiva },
                cache: false,
                success: function (data) {
                    if (da == 0) {
                        $('#idEccezioniList').replaceWith(data);
                    }
                    else {
                        var tHTML = $.parseHTML(data);
                        data = $(tHTML).find('tr[class*=hid]');
                        $('#' + listaAttiva + ' tr[class*=hid]').last().after(data);
                        richiamascroll = true;
                    }

                    UIRai.initHelpers('strumenti-table');

                    jQuery('[data-toggle="tabs"] a, .js-tabs a').click(function (e) {
                        e.preventDefault();
                        jQuery(this).tab('show');
                    });


                    $("#idEccezioniList>.block").removeClass("block-opt-refresh"); //serve per chiudere il loader
                    //$("#my-block>.block").removeClass("block-opt-refresh");


                    $('[data-isEditable=False] button').remove();  // nasconde i bottoni se non si hanno i diritti
                },
                error: function (a, b, c) {

                    // alert("Ajax Error:" + a + ',' + b + ',' + c);
                }
            });
            return false;
        }

        function IsElementOutViewport(elem) {
            var win = $(window);
            var viewport = {
                top: win.scrollTop(),
                left: win.scrollLeft()
            };
            viewport.right = viewport.left + win.width();
            viewport.bottom = viewport.top + win.height();
            var bounds = elem.offset();
            bounds.right = bounds.left + elem.outerWidth();
            bounds.bottom = bounds.top + elem.outerHeight();
            var isOut = (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));
            return isOut;
        }
    </script>



</body>
</html>
