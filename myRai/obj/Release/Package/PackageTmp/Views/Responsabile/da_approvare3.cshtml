@using System.Globalization;
@using myRaiHelper;
@using myRaiCommonModel;
@using MVCProject.Custom_Helpers;

@model ModelDash

<div id="blockDayRound" class="block remove-margin-bottom" style="display:none;">
    <div class="block-content" style="padding:0px;">
        <div class="block remove-margin-bottom" id="my-block2">
            <ul class="nav nav-tabs nav-tabs-alt nav-justified" data-toggle="tabs" role="tablist">
                @if ( Model.elencoProfilieSedi != null )
                {
                    bool firstTab = true;
                    foreach ( var ragg in Model.elencoProfilieSedi.RaggruppamentiEccezioni )
                    {
                        <li class="text-center @(ragg.IdRaggruppamento==0?"active":"")" role="presentation">
                            <a role="tab" class="font-w600 rai-badge-anchor" tabindex="@(firstTab?"0":"-1")" aria-selected="@(ragg.IdRaggruppamento == 0 ? "true" : "false")" aria-controls="tab2-@ragg.IdRaggruppamento" href="#tab2-@ragg.IdRaggruppamento">
                                @ragg.Descrizione.TitleCase( )
                                @if ( ragg.IdRaggruppamento == 0 && Model.ViewUtility.TotRich > 0 )
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10"><span class="text-smaller text-bold ">@Model.ViewUtility.TotRich</span></div>
                                }
                                else if ( ragg.IdRaggruppamento == 1 ) // && Model.ViewUtility.TotUrg > 0)
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10">
                                        <span id="badge-tot-u" class="text-smaller text-bold">@Model.ViewUtility.TotUrg</span>
                                    </div>
                                }
                                else if ( ragg.IdRaggruppamento == 2 )// && Model.ViewUtility.TotS > 0)
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10">
                                        <span id="badge-tot-s" class="text-smaller text-bold">@Model.ViewUtility.TotS</span>
                                    </div>
                                }
                                else if ( ragg.IdRaggruppamento == 3 ) // && Model.ViewUtility.TotOrd > 0)
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10"><span class="text-smaller text-bold ">@Model.ViewUtility.TotOrd</span></div>
                                }
                            </a>
                        </li>
                        firstTab = false;
                    }
                }
            </ul>


            <div id="appr" class="block-content tab-content">
                @if ( Model.elencoProfilieSedi == null )
                {
                    <span class="my-card-loading-block" style="width: 28%; height: 18px;"></span>
                    <span class="my-card-loading-block" style="width: 10%; height: 8px;"></span>
                }

                @if ( Model.elencoProfilieSedi != null )
                {
                    //per ogni tab (tutto/urgenti/scadute/altro)
                    foreach ( var ragg in Model.elencoProfilieSedi.RaggruppamentiEccezioni )
                    {
                        <div role="tabpanel" class="tab-pane tab-filtro @(ragg.IdRaggruppamento == 0 ? "active" : "")" id="tab2-@ragg.IdRaggruppamento">
                            <div id="approv">
                                @if ( Request.QueryString["nome"] != "" || Request.QueryString["sede"] != "" ||
                 Request.QueryString["stato"] != "" || Request.QueryString["eccezione"] != "" ||
                 Request.QueryString["data_da"] != "" || Request.QueryString["data_a"] != "" ||
                 Request.QueryString["OpzioneRicercaVisti"] != "" ||
                 Request.QueryString["livelloDip"] != "" )
                                {
                                    <div class="block">
                                        <div class="row">
                                            <div class="col-sm-9">
                                                Hai Cercato:
                                                @if ( Request.QueryString["nome"] != "" )
                                                {<b>@Request.QueryString["nome"], </b>}
                                                @if ( Request.QueryString["sede"] != "" )
                                                {<b>@Request.QueryString["sede"], </b>}
                                                @if ( Request.QueryString["stato"] != "" )
                                                {<b>@Request.QueryString["stato"], </b>}
                                                @if ( Request.QueryString["eccezione"] != "" )
                                                {<b>@Request.QueryString["eccezione"], </b>}
                                                @if ( Request.QueryString["data_da"] != "" && Request.QueryString["data_a"] == "" )
                                                {<b>@Request.QueryString["data_da"] - @DateTime.Now.ToShortDateString( ),</b>}
                                                @if ( Request.QueryString["data_da"] != "" && Request.QueryString["data_a"] != "" )
                                                {<b>@Request.QueryString["data_da"] - @Request.QueryString["data_a"],</b>}
                                                @if ( Request.QueryString["livelloDip"] != "" )
                                                {<b>dipendenti di livello @Request.QueryString["livelloDip"]</b>}
                                                @if (Request.QueryString["OpzioneRicercaVisti"] == "VP")
                                                {
                                                    <b>Visti positivi</b>
                                                }
                                                @if (Request.QueryString["OpzioneRicercaVisti"] == "VN")
                                                {
                                                    <b>Visti negativi</b>
                                                }
                                            </div>
                                            <div class="col-sm-3">
                                                <a href="#" onclick="$(':text').val('');$(':input,select option').removeAttr('checked').removeAttr('selected');$('#btnFilter').attr('disabled', 'disabled');" data-reset="/home/refreshDaApprovare" data-parentdiv="daapprovare" data-resetelements="my-block,my-block2">TORNA ALL'ELENCO</a>
                                            </div>
                                        </div>
                                    </div>
                                }

                                <table id="tabapp" class="js-table-sections table rai-table" role="grid">
                                    <thead>
                                        <tr>
                                            <th style="width: 5%;"></th>
                                            <th style="width: 5%;"></th>
                                            <th style="width: 20%;"></th>
                                            <th style="width: 25%;"></th>
                                            <th style="width: 25%;"></th>
                                            <th style="width: 20%;"></th>



                                        </tr>
                                    </thead>

                                    @if ( Model.elencoProfilieSedi != null && Model.ViewUtility.TotRich > 0
                                        && ( ragg.IdRaggruppamento == 0
                                        || ( ragg.IdRaggruppamento == 1 && Model.ViewUtility.TotUrg > 0 )
                                        || ( ragg.IdRaggruppamento == 2 && Model.ViewUtility.TotS > 0 )
                                        || ( ragg.IdRaggruppamento == 3 && Model.ViewUtility.TotOrd > 0 ) ) )
                                    {
                                        int sediVisualizzate = 0;
                                        //per ogni sede nel tab
                                        foreach ( daApprovareModel.sedegappAbilitata SedeAbil in Model.elencoProfilieSedi.elencoSediEccezioni.Where( f => f.Accesso_in_scrittura ) )
                                        {
                                            int countEcc = 0;

                                            var listEcc = SedeAbil.eccezionidaValidare
                                                    .Where( d => ragg.IdRaggruppamento == 0 ||
                                                         ( ragg.IdRaggruppamento == 1 && d.IsUrgent == true ) ||
                                                         ( ragg.IdRaggruppamento == 2 && d.IsOverdue == true ) ||
                                                         ( ragg.IdRaggruppamento == 3 && d.IsOverdue == false && d.IsUrgent == false )
                                                       );

                                            countEcc = listEcc.Count( );
                                            if ( countEcc == 0 )
                                            {
                                                continue;
                                            }
                                            sediVisualizzate++;

                                            //intestazione sede + totale richieste
                                            <tbody class="@(Model.elencoProfilieSedi.elencoSediEccezioni.Count == 1 ? "js-table-sections-header open" : "js-table-sections-header")">
                                                <tr role="row" tabindex="@(sediVisualizzate == 1 ? "0" : "-1")" aria-label="Per la sede @SedeAbil.Codice_sede_gapp, hai @countEcc richieste da validare" aria-expanded="false">
                                                    <td class="text-center no-padding-right" @*onclick="$(this).closest('tbody').toggleClass('open')"*@>
                                                        <i class="fa fa-angle-right  interactive-primary-color">&nbsp;</i>
                                                    </td>
                                                    <td colspan="3" class="no-padding-left" @*onclick="$(this).closest('tbody').toggleClass('open')"*@>
                                                        <span class="rai-font-md-bold"
                                                              data-rep-desc="@SedeAbil.RepartoDescrizione"
                                                              data-rep-cod="@SedeAbil.RepartoCodice">
                                                            @SedeAbil.Codice_sede_gapp.ToUpper( )<span class="rai-font-md"> - @CommonHelper.ToTitleCase( SedeAbil.Descrittiva_sede_gapp )</span>
                                                            @if ( SedeAbil.RepartoCodice != "00" )
                                                            {
                                                                <br />
                                                                <span class="base-text text-smaller text-italic">@SedeAbil.RepartoDescrizione</span>
                                                            }
                                                        </span>
                                                    </td>

                                                    <td colspan="2" class="text-right">
                                                        <span class="base-text rai-text-bold-12 rai-alert-dot">
                                                            @countEcc.ToString( ) richiest@(countEcc == 1 ? "a" : "e")
                                                        </span>
                                                    </td>
                                                </tr>
                                            </tbody>

                                            <tbody class="tbodydata ">
                                                <tr>
                                                    <td colspan="6">
                                                        <table id="tabappData" class="js-table-sections table rai-table" role="grid">
                                                            @{
                                                                var raggPerData = listEcc.GroupBy( x => new { x.DataRichiesta , x.CodiceTurno } );
                                                                foreach ( var itemData in raggPerData )
                                                                {
                                                                    <tbody class="js-table-sections-header">
                                                                        <tr role="row" tabindex="0" aria-label="Per la data di @itemData.Key.DataRichiesta.ToString("d MMMM yyyy"), hai @itemData.Count() richieste da validare" aria-expanded="false" onfocus="onFocusRow(this)">
                                                                            <td class="text-right">
                                                                                <i class="fa fa-angle-right interactive-primary-color"></i>
                                                                            </td>
                                                                            <td colspan="3" class="no-padding-left">
                                                                                <span class="rai-font-md">@itemData.Key.DataRichiesta.ToString( "d MMMM yyyy" )@(!String.IsNullOrWhiteSpace( itemData.Key.CodiceTurno ) ? " - " + itemData.Key.CodiceTurno : "")</span>
                                                                            </td>

                                                                            <td colspan="2" class="text-right td-num-ragg-appr" style="padding-top:15px">
                                                                                <span class="base-text rai-text-bold-12 rai-alert-dot">@itemData.Count( ) richiest@(@itemData.Count( ) == 1 ? "a" : "e")</span>
                                                                            </td>

                                                                            <td colspan="2" class="text-right td-button-ragg-appr">
                                                                                @if ( String.IsNullOrWhiteSpace(Model.RicercaVisti))
                                                                                {

                                                                                
                                                                                <button class="pad6 button-approva-turno btn btn-xs btn-default button-ragg-appr" type="submit" role="link" tabindex="-1" 
                                                                                        @if (Model.RichiedeVisti)
                                                                                        {
                                                                                            @:data-richiedevisto="1"
                                                                                        }
                                                                                        aria-label="Approva tutte le richieste per il turno @(itemData.Key.CodiceTurno) del @(itemData.Key.DataRichiesta.ToString("d MMMM yyyy"))">
                                                                                    Approva tutti
                                                                                </button>
                                                                                <button class="pad6 btn button-rifiuta-turno btn-xs btn-default button-ragg-appr" type="submit" role="link" tabindex="-1" 
                                                                                         @if (Model.RichiedeVisti)
                                                                                        {
                                                                                            @:data-richiedevisto="1"
                                                                                        }
                                                                                        aria-label="Approva tutte le richieste per il turno @(itemData.Key.CodiceTurno) del @(itemData.Key.DataRichiesta.ToString("d MMMM yyyy"))">
                                                                                    Rifiuta tutti
                                                                                </button>
                                                                                }
                                                                            </td>

                                                                        </tr>
                                                                    </tbody>

                                                                    <tbody class="tbodydata body-stripes">

                                                                        @{
                                                                            var raggMatr = itemData.GroupBy( x => x.matricola );

                                                                            foreach ( var itemMatr in raggMatr )
                                                                            {
                                                                                <tr role="row" onfocus="onFocusRow(this)">
                                                                                    <td colspan="6">
                                                                                        <div class="row">
                                                                                            <div class="col-sm-4">
                                                                                                @{
                                                                                                    var dip = itemMatr.First( );
                                                                                                    var cognome = dip.dipendente.cognome;
                                                                                                    var nome = dip.dipendente.nome;
                                                                                                    string action = "javascript:ShowPopupBoss('0" + itemMatr.Key + "','" + itemData.Key.DataRichiesta.ToString("dd/MM/yyyy") + "','" + 
                                                                                                        (nome !=null ? nome.Trim().ToUpper() : nome)
                                                                                                        + " " + 
                                                                                                        (cognome!=null?cognome.Trim().ToUpper():cognome) 
                                                                                                        + "','1')";
                                                                                                }
                                                                                                @Html.ProfileWidgetAction( itemMatr.Key , cognome + " " + nome , action , null )

                                                                                                @{
                                                                                                    var eccVis = Model.elencoProfilieSedi.EccVisualizzate.Where( i => i.Matricola.Equals( itemMatr.Key ) && i.Data.Equals( itemData.Key.DataRichiesta ) ).FirstOrDefault( );
                                                                                                    if ( eccVis != null && eccVis.Visualizzato )
                                                                                                    {
                                                                                                        <div title="VISUALIZZATO" style="background-color: #eeeeee;">
                                                                                                            <span style="font-weight: 500;font-size: 9px;color:#000000;" title="Visualizzato da @eccVis.Visualizzatore">VISUALIZZATO</span>
                                                                                                        </div>
                                                                                                    }
                                                                                                }
                                                                                                <br />
                                                                                                <div class="push-10-t">
                                                                                                    @if ( String.IsNullOrWhiteSpace( Model.RicercaVisti ) )
                                                                                                    {


                                                                                                        <button class="pad6 button-approva-matricola btn btn-xs btn-default button-ragg-appr" type="submit"
                                                                                                                @if ( Model.RichiedeVisti ) { @: data-richiedevisto="1"
                                                                                                                }
                                                                                                                aria-label="Approva tutte le richieste di @(itemMatr.First().dipendente.nome) @(itemMatr.First().dipendente.cognome)">
                                                                                                        Approva tutti
                                                                                                    </button>
                                                                                                        <button class="pad6 btn button-rifiuta-matricola btn-xs btn-default button-ragg-appr" type="submit"
                                                                                                                @if ( Model.RichiedeVisti ) { @: data-richiedevisto="1"
                                                                                                                }
                                                                                                                aria-label="Approva tutte le richieste di @(itemMatr.First().dipendente.nome) @(itemMatr.First().dipendente.cognome)">
                                                                                                        Rifiuta tutti
                                                                                                    </button>
                                                                                                    }
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="col-sm-8">
                                                                                                <table class="js-table-sections table table-hover">
                                                                                                    @foreach ( var item in itemMatr )
                                                                                                    {
                                                                                                        EccezioneApprovatoreVM vm = new EccezioneApprovatoreVM( )
                                                                                                        {
                                                                                                            Eccezione = item ,
                                                                                                            RichiedeVisto=Model.RichiedeVisti,
                                                                                                            Visualizzato = false ,
                                                                                                            attivitaCeiton = Model.ViewUtility.GetAttivitaCeiton( item.IdRichiestaPadre )
                                                                                                        };

                                                                                                        if ( Model.elencoProfilieSedi.EccVisualizzate != null )
                                                                                                        {
                                                                                                            var myItem = Model.elencoProfilieSedi.EccVisualizzate.Where( i => i.Matricola.Equals( item.matricola ) && i.Data.Equals( item.dataCompleta ) ).FirstOrDefault( );

                                                                                                            if ( myItem != null )
                                                                                                            {
                                                                                                                vm.Visualizzato = myItem.Visualizzato;
                                                                                                                vm.Visualizzatore = myItem.Visualizzatore;
                                                                                                            }
                                                                                                        }

                                                                                                        @Html.Partial( "~/Views/Responsabile/_TRdaapprovare3.cshtml" , vm )
                                                                                                    }
                                                                                                </table>
                                                                                            </div>
                                                                                        </div>
                                                                                    </td>
                                                                                </tr>
                                                                            }

                                                                        }

                                                                    </tbody>

                                                                }


                                                            }
                                                        </table>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        }
                                        if ( sediVisualizzate == 0 )
                                        {
                                            <tbody>
                                                @Html.Partial( "_nodati" )
                                            </tbody>
                                        }
                                    }
                                    else
                                    {
                                        <tbody>
                                            @Html.Partial( "_nodati" )
                                        </tbody>
                                    }
                                </table>



                            </div>



                            @if ( Model.elencoProfilieSedi != null && Model.elencoProfilieSedi.FrecciaVisibile )
                            {
                                <div class="block-content block-content-full text-center">
                                    <a href="/Responsabile/totaledaapprovare"><i class="si si-arrow-right fa-2x text-info"></i></a>
                                </div>
                            }
                        </div>
                    }
                }
            </div>


        </div>
    </div>
</div>

<div id="blockDay" class="block  remove-margin-bottom" style="display:none;">
    <div class="block-content" style="padding:0px;">
        <div class="block remove-margin-bottom" id="my-block3">
            <ul class="nav nav-tabs nav-tabs-alt nav-justified" data-toggle="tabs" role="tablist">
                @if ( Model.elencoProfilieSedi != null )
                {
                    bool firstTab = true;
                    foreach ( var ragg in Model.elencoProfilieSedi.RaggruppamentiEccezioni )
                    {
                        <li class="text-center @(ragg.IdRaggruppamento == 0?"active":"")" role="presentation">
                            <a role="tab" class="font-w600 rai-badge-anchor" tabindex="@(firstTab?"0":"-1")" aria-selected="@(ragg.IdRaggruppamento == 0 ? "true" : "false")" aria-controls="tab2Day-@ragg.IdRaggruppamento" href="#tab2Day-@ragg.IdRaggruppamento">
                                @ragg.Descrizione.TitleCase( )
                                @if ( ragg.IdRaggruppamento == 0 && Model.ViewUtility.TotRich > 0 )
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10"><span class="text-smaller text-bold ">@Model.ViewUtility.TotRich</span></div>
                                }
                                else if ( ragg.IdRaggruppamento == 1 )
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10">
                                        <span id="badge-tot-u" class="text-smaller text-bold">@Model.ViewUtility.TotUrg</span>
                                    </div>
                                }
                                else if ( ragg.IdRaggruppamento == 2 )
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10">
                                        <span id="badge-tot-s" class="text-smaller text-bold">@Model.ViewUtility.TotS</span>
                                    </div>
                                }
                                else if ( ragg.IdRaggruppamento == 3 )
                                {
                                    <div class="rai-badge-tab bg-neutrals-xl-10"><span class="text-smaller text-bold ">@Model.ViewUtility.TotOrd</span></div>
                                }
                            </a>
                        </li>
                        firstTab = false;
                    }
                }
            </ul>


            <div id="appr" class="block-content tab-content">


                @if ( Model.elencoProfilieSedi == null )
                {
                    <span class="my-card-loading-block" style="width: 28%; height: 18px;"></span>
                    <span class="my-card-loading-block" style="width: 10%; height: 8px;"></span>
                }

                @if ( Model.elencoProfilieSedi != null )
                {
                    //per ogni tab (tutto/urgenti/scadute/altro)
                    foreach ( var ragg in Model.elencoProfilieSedi.RaggruppamentiEccezioni )
                    {
                        <div role="tabpanel" class="tab-pane tab-filtro @(ragg.IdRaggruppamento == 0 ? "active" : "")" id="tab2Day-@ragg.IdRaggruppamento">
                            <div id="approv">
                                @if ( Request.QueryString["nome"] != "" || Request.QueryString["sede"] != "" ||
                                 Request.QueryString["stato"] != "" || Request.QueryString["eccezione"] != "" ||
                                 Request.QueryString["data_da"] != "" || Request.QueryString["data_a"] != "" ||
                                 Request.QueryString["data_a"] != "" ||
                                 Request.QueryString["OpzioneRicercaVisti"] != "")
                                {
                                    <div class="block">
                                        <div class="row">
                                            <div class="col-sm-9">
                                                Hai Cercato:
                                                @if ( Request.QueryString["nome"] != "" )
                                                {<b>@Request.QueryString["nome"], </b>}
                                                @if ( Request.QueryString["sede"] != "" )
                                                {<b>@Request.QueryString["sede"], </b>}
                                                @if ( Request.QueryString["stato"] != "" )
                                                {<b>@Request.QueryString["stato"], </b>}
                                                @if ( Request.QueryString["eccezione"] != "" )
                                                {<b>@Request.QueryString["eccezione"], </b>}
                                                @if ( Request.QueryString["data_da"] != "" && Request.QueryString["data_a"] == "" )
                                                {<b>@Request.QueryString["data_da"] - @DateTime.Now.ToShortDateString( ),</b>}
                                                @if ( Request.QueryString["data_da"] != "" && Request.QueryString["data_a"] != "" )
                                                {<b>@Request.QueryString["data_da"] - @Request.QueryString["data_a"],</b>}
                                                @if ( Request.QueryString["livelloDip"] != "" )
                                                {<b>dipendenti di livello @Request.QueryString["livelloDip"]</b>}
                                                @if (Request.QueryString["OpzioneRicercaVisti"] == "VP")
                                                {
                                                    <b>Visti positivi</b>
                                                }
                                                @if (Request.QueryString["OpzioneRicercaVisti"] == "VN")
                                                {
                                                    <b>Visti negativi</b>
                                                }
                                            </div>
                                            <div class="col-sm-3">
                                                <a href="#" onclick="$(':text').val('');$(':input,select option').removeAttr('checked').removeAttr('selected');$('#btnFilter').attr('disabled', 'disabled');" data-reset="/home/refreshDaApprovare" data-parentdiv="daapprovare" data-resetelements="my-block,my-block2">TORNA ALL'ELENCO</a>
                                            </div>
                                        </div>
                                    </div>
                                }
                                <table id="tabapp" class="js-table-sections table rai-table" role="grid">
                                    <thead>
                                        <tr>
                                            <th style="width: 5%;"></th>
                                            <th style="width: 5%;"></th>
                                            <th style="width: 20%;"></th>
                                            <th style="width: 25%;"></th>
                                            <th style="width: 25%;"></th>
                                            <th style="width: 20%;"></th>



                                        </tr>
                                    </thead>

                                    @if ( Model.elencoProfilieSedi != null && Model.ViewUtility.TotRich > 0
                                        && ( ragg.IdRaggruppamento == 0
                                        || ( ragg.IdRaggruppamento == 1 && Model.ViewUtility.TotUrg > 0 )
                                        || ( ragg.IdRaggruppamento == 2 && Model.ViewUtility.TotS > 0 )
                                        || ( ragg.IdRaggruppamento == 3 && Model.ViewUtility.TotOrd > 0 ) ) )
                                    {
                                        int sediVisualizzate = 0;
                                        //per ogni sede nel tab
                                        foreach ( daApprovareModel.sedegappAbilitata SedeAbil in Model.elencoProfilieSedi.elencoSediEccezioni.Where( f => f.Accesso_in_scrittura ) )
                                        {
                                            int countEcc = 0;

                                            var listEcc = SedeAbil.eccezionidaValidare
                                                    .Where( d => ragg.IdRaggruppamento == 0 ||
                                                         ( ragg.IdRaggruppamento == 1 && d.IsUrgent == true ) ||
                                                         ( ragg.IdRaggruppamento == 2 && d.IsOverdue == true ) ||
                                                         ( ragg.IdRaggruppamento == 3 && d.IsOverdue == false && d.IsUrgent == false )
                                                       );

                                            countEcc = listEcc.Count( );
                                            if ( countEcc == 0 )
                                            {
                                                continue;
                                            }
                                            sediVisualizzate++;

                                            //intestazione sede + totale richieste
                                            <tbody class="@(Model.elencoProfilieSedi.elencoSediEccezioni.Count == 1 ? "js-table-sections-header open" : "js-table-sections-header")">
                                                <tr role="row" tabindex="@(sediVisualizzate == 1 ? "0" : "-1")" aria-label="Per la sede @SedeAbil.Codice_sede_gapp, hai @countEcc richieste da validare" aria-expanded="false">
                                                    <td class="text-center no-padding-right">
                                                        <i class="fa fa-angle-right interactive-primary-color"></i>
                                                    </td>
                                                    <td colspan="3" class="no-padding-left">
                                                        <span class="cod-sede"
                                                              data-rep-desc="@SedeAbil.RepartoDescrizione"
                                                              data-rep-cod="@SedeAbil.RepartoCodice">
                                                            @SedeAbil.Codice_sede_gapp.ToUpper( )<span class="desc-sede"> - @CommonHelper.ToTitleCase( SedeAbil.Descrittiva_sede_gapp )</span>
                                                            @if ( SedeAbil.RepartoCodice != "00" )
                                                            {
                                                                <br />
                                                                <span class="base-text text-smaller text-italic">@SedeAbil.RepartoDescrizione</span>
                                                            }
                                                        </span>
                                                    </td>

                                                    <td colspan="2" class="text-right">
                                                        <span class="base-text rai-text-bold-12 rai-alert-dot">
                                                            @countEcc.ToString( ) richiest@(countEcc == 1 ? "a" : "e")
                                                        </span>
                                                    </td>
                                                </tr>
                                            </tbody>

                                            <tbody class="tbodydata">
                                                <tr>
                                                    <td colspan="6">
                                                        <table id="tabappData" class="js-table-sections table rai-table" role="grid">
                                                            @{
                                                                var raggPerData = listEcc.GroupBy( x => x.DataRichiesta );



                                                                foreach ( var itemData in raggPerData )
                                                                {
                                                                    <tbody class="js-table-sections-header">
                                                                        <tr role="row" tabindex="0" aria-label="Per la data di @itemData.Key.ToString("d MMMM yyyy"), hai @itemData.Count() richieste da validare" aria-expanded="false" onfocus="onFocusRow(this)">
                                                                            <td class="text-right" style="width:5%;">
                                                                                <i class="fa fa-angle-right interactive-primary-color"></i>
                                                                            </td>
                                                                            <td colspan="3" class="no-padding-left">
                                                                                <span class="base-text rai-text-normal text-center font-w400">@itemData.Key.ToString( "d MMMM yyyy" )</span>
                                                                            </td>

                                                                            <td colspan="2" class="text-right td-num-ragg-appr" style="padding-top:15px">
                                                                                <span class="base-text rai-text-bold-12 rai-alert-dot">@itemData.Count( ) richiest@(@itemData.Count( ) == 1 ? "a" : "e")</span>
                                                                            </td>

                                                                            <td colspan="2" class="text-right td-button-ragg-appr">
                                                                                @if (String.IsNullOrWhiteSpace(Model.RicercaVisti))
                                                                                {
                                                                                    <button class="pad6 button-approva-turno btn btn-xs btn-default button-ragg-appr" type="submit" role="link" tabindex="-1"
                                                                                            @if (Model.RichiedeVisti) { @: data-richiedevisto="1"
                                                                                            }
                                                                                            aria-label="Approva tutte le richieste per il giorno @(itemData.Key.ToString("d MMMM yyyy"))">
                                                                                    Approva tutti
                                                                                </button>
                                                                                <button class="pad6 btn button-rifiuta-turno btn-xs btn-default button-ragg-appr" type="submit" role="link" tabindex="-1"
                                                                                        @if (Model.RichiedeVisti) { @: data-richiedevisto="1"
                                                                                        }
                                                                                        aria-label="Approva tutte le richieste per il giorno @(itemData.Key.ToString("d MMMM yyyy"))">
                                                                                    Rifiuta tutti
                                                                                </button>
                                                                                }
                                                                            </td>

                                                                        </tr>
                                                                    </tbody>

                                                                    <tbody class="tbodydata body-stripes">

                                                                        @{
                                                                            var raggMatr = itemData.GroupBy( x => x.matricola );

                                                                            foreach ( var itemMatr in raggMatr )
                                                                            {
                                                                                <tr role="row" onfocus="onFocusRow(this)">
                                                                                    <td colspan="6">
                                                                                        <div class="row">
                                                                                            <div class="col-sm-4">
                                                                                                @{
                                                                                                    var dip = itemMatr.First( );
                                                                                                    var cognome = dip.dipendente.cognome;
                                                                                                    var nome = dip.dipendente.nome;
                                                                                                    string action = "javascript:ShowPopupBoss('0" + itemMatr.Key + "','" + itemData.Key.ToString("dd/MM/yyyy") + "','" + 
                                                                                                        (nome != null ? nome.Trim().ToUpper():nome)
                                                                                                        + " " + 
                                                                                                        (cognome!=null ? cognome.Trim().ToUpper():cognome)
                                                                                                        + "','1')";
                                                                                                }
                                                                                                @Html.ProfileWidgetAction( itemMatr.Key , cognome + " " + nome , action , null )
                                                                                                @{
                                                                                                    var eccVis = Model.elencoProfilieSedi.EccVisualizzate.Where( i => i.Matricola.Equals( itemMatr.Key ) && i.Data.Equals( itemData.Key ) ).FirstOrDefault( );
                                                                                                    if ( eccVis != null && eccVis.Visualizzato )
                                                                                                    {
                                                                                                        <div title="VISUALIZZATO" style="background-color: #eeeeee;">
                                                                                                            <span style="font-weight: 500;font-size: 9px;color:#000000;" title="Visualizzato da @eccVis.Visualizzatore">VISUALIZZATO</span>
                                                                                                        </div>
                                                                                                    }
                                                                                                }
                                                                                                <div class="push-10-t">
                                                                                                            @if ( String.IsNullOrWhiteSpace( Model.RicercaVisti ) )
                                                                                                            {
                                                                                                                <button class="pad6 button-approva-matricola btn btn-xs btn-default button-ragg-appr" type="submit"
                                                                                                                        @if ( Model.RichiedeVisti ) { @: data-richiedevisto="1"
                                                                                                                        }
                                                                                                                        aria-label="Approva tutte le richieste di @(itemMatr.First().dipendente.nome) @(itemMatr.First().dipendente.cognome)">
                                                                                                        Approva tutti
                                                                                                    </button>
                                                                                                                <button class="pad6 btn button-rifiuta-matricola btn-xs btn-default button-ragg-appr" type="submit"
                                                                                                                        @if ( Model.RichiedeVisti ) { @: data-richiedevisto="1"
                                                                                                                        }
                                                                                                                        aria-label="Approva tutte le richieste di @(itemMatr.First().dipendente.nome) @(itemMatr.First().dipendente.cognome)">
                                                                                                        Rifiuta tutti
                                                                                                    </button>
                                                                                                            }
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="col-sm-8">
                                                                                                <table class="js-table-sections table table-hover">
                                                                                                    @foreach ( var item in itemMatr )
                                                                                                    {
                                                                                                        EccezioneApprovatoreVM vm = new EccezioneApprovatoreVM( )
                                                                                                        {
                                                                                                            Eccezione = item ,
                                                                                                            RichiedeVisto = Model.RichiedeVisti,
                                                                                                            Visualizzato = false ,
                                                                                                            attivitaCeiton = Model.ViewUtility.GetAttivitaCeiton( item.IdRichiestaPadre )


                                                                                                        };

                                                                                                        if ( Model.elencoProfilieSedi.EccVisualizzate != null )
                                                                                                        {
                                                                                                            var myItem = Model.elencoProfilieSedi.EccVisualizzate.Where( i => i.Matricola.Equals( item.matricola ) && i.Data.Equals( item.dataCompleta ) ).FirstOrDefault( );

                                                                                                            if ( myItem != null )
                                                                                                            {
                                                                                                                vm.Visualizzato = myItem.Visualizzato;
                                                                                                            }
                                                                                                        }

                                                                                                        @Html.Partial( "~/Views/Responsabile/_TRdaapprovare3.cshtml" , vm )
                                                                                                    }
                                                                                                </table>
                                                                                            </div>
                                                                                        </div>
                                                                                    </td>
                                                                                </tr>
                                                                            }

                                                                        }

                                                                    </tbody>

                                                                }


                                                            }
                                                        </table>
                                                    </td>
                                                </tr>


                                            </tbody>
                                        }
                                        if ( sediVisualizzate == 0 )
                                        {
                                            <tbody>
                                                @Html.Partial( "_nodati" )
                                            </tbody>
                                        }
                                    }
                                    else
                                    {
                                        <tbody>
                                            @Html.Partial( "_nodati" )
                                        </tbody>
                                    }
                                </table>



                            </div>



                            @if ( Model.elencoProfilieSedi != null && Model.elencoProfilieSedi.FrecciaVisibile )
                            {
                                <div class="block-content block-content-full text-center">
                                    <a href="/Responsabile/totaledaapprovare"><i class="si si-arrow-right fa-2x text-info"></i></a>
                                </div>
                            }
                        </div>
                    }
                }
            </div>


        </div>
    </div>
</div>